# Шифрование существующих разделов

Шифрование разделов с данными сводится к следующим операциям:
1. Уменьшение размера файловой системы
2. Шифрование раздела
3. Увеличение файловой системы до максимума

Таким способом можно зашифровать только разделы с файловыми системами поддерживающими ресайз.

## BTRFS

### Проверка файловой системы

Перед всеми операциями с файловой системой стоит проверить файловую систему:
```bash
btrfs check /dev/sda1
```

### Уменьшение файловой системы

Уменьшение размера файловой системы BTRFS на разделе `sda1`:
```bash
mkdir /mnt/sda1
mount /dev/sda1 /mnt/sda1
btrfs filesystem resize -16M /mnt/sda1
umount /mnt/sda1
```

### Шифрование раздела

**ВНИМАНИЕ! Данная операция может привести к потере данных. Обязательно делайте бэкапы.**

Шифрование раздела `sda1`:
```bash
cryptsetup reencrypt --encrypt --reduce-device-size=16M /dev/sda1
```

### Проверка файловой системы после шифрование

```bash
cryptsetup open /dev/sda1 sda1
btrfs check /dev/mapper/sda1
```


### Увеличение файловой системы до максимума

```bash
mount /dev/mapper/sda1 /mnt/sda1
btrfs filesystem resize max /mnt/sda1
umount /mnt/sda1
```
